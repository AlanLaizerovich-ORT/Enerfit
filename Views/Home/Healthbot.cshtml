<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthBot - Enerfit</title>
    <link rel="stylesheet" href="style.css">

    <style>
        /* Asegura que el chat tenga scroll */
        .chat-box {
            height: 450px;
            overflow-y: auto;
            padding: 10px;
        }
    </style>
</head>

<body>

    <div class="chatbot-wrapper">
        <div class="chatbot-container">

            <header>
                <h2>
                    HealthBot <span>Enerfit</span>
                    <a href="/Home/Tutorial"><img src="/Imagenes/Info.png" alt=""></a>
                </h2>
            </header>

            <!-- üî• CONTENEDOR DEL CHAT (necesario para que responda) -->
            <div id="chat-box" class="chat-box">

                <!-- üî• MENSAJE INICIAL DEL BOT -->
                <div class="message bot-message">
                    <div class="avatar bot-avatar">
                        <img src="/Imagenes/Fitty.png" alt="">
                    </div>

                    <div class="bubble">
                        Hola, soy Fitty. Decime qu√© quer√©s hacer:<br><br>

                        1) Entrenamiento<br>
                        2) Alimentaci√≥n<br>
                        3) Planes por objetivo<br>
                        4) Crear rutina o dieta<br>
                        5) Perfil<br>
                        6) Videos<br>
                        7) Bienestar y descanso<br>
                        8) Tutorial del asistente<br>
                        0) Nada por ahora<br><br>

                        Pod√©s escribir el n√∫mero o la palabra clave.
                    </div>
                </div>

            </div>

            <!-- ===================== INPUT ===================== -->
            <div class="input-area">
                <input type="text" id="userMessage" placeholder="Escrib√≠ tu mensaje...">
                <button id="sendBtn">Enviar</button>
            </div>

        </div>
    </div>


    <!-- ===================== JS ===================== -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>

        $("#sendBtn").click(function () {
            sendMessage();
        });

        $("#userMessage").keypress(function (e) {
            if (e.which === 13) sendMessage();
        });

        function sendMessage() {

            var userMessage = $("#userMessage").val().trim();
            if (userMessage === "") return;


            // üîµ Mostrar mensaje del usuario
            $("#chat-box").append(`
                <div class="message user-message">
                    <div class="bubble">${userMessage}</div>
                    <div class="avatar user-avatar">üßç‚Äç‚ôÇÔ∏è</div>
                </div>
            `);

            $("#userMessage").val("");
            $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);


            // üü¢ AJAX al controlador
            $.ajax({
                type: "POST",
                url: "/Home/GetResponse",
                data: { userMessage: userMessage },

                success: function (data) {

                    // Respuesta del bot
                    $("#chat-box").append(`
                        <div class="message bot-message">
                            <div class="avatar bot-avatar">
                                <img src="/Imagenes/Fitty.png" alt="">
                            </div>
                            <div class="bubble">${data.reply}</div>
                        </div>
                    `);

                    // Redirecci√≥n si corresponde
                    if (data.redirect) {
                        setTimeout(() => {
                            window.location.href = data.redirect;
                        }, 2000);
                    }

                    $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                },

                error: function () {
                    $("#chat-box").append(`
                        <div class="message bot-message">
                            <div class="avatar bot-avatar">
                                <img src="/Imagenes/Fitty.png" alt="">
                            </div>
                            <div class="bubble">Ocurri√≥ un error al procesar tu mensaje.</div>
                        </div>
                    `);
                }
            });
        }

    </script>

</body>
</html>
